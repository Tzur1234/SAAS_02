{% extends "base.html" %} {% load static i18n %} {% block css %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
/>
<link
  rel="text/javascript"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
/>
<link
  rel="text/javascript"
  href="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
/>

<!-- My css files -->
<link href="{% static 'demo/css/styles.css' %}" />

<script src="{% static 'demo/js/demo.js' %}"></script>
{% endblock %} 


{% block content %}
<div class="container card-0 justify-content-center">
  <div class="card-body px-sm-4 px-0">
    <div class="row justify-content-center mb-5">
      <div class="col-md-10 col">
        <h3 class="font-weight-bold ml-md-0 mx-auto text-center text-sm-left">
          UPLOAD YOUR IMAGE
        </h3>
        <p class="mt-md-4 ml-md-0 ml-2 text-center text-sm-left">
          Entrust with heigh professionalism we are offering pixel perfect web
          and mobile application development third party integration and
          solution to our.
        </p>
      </div>
    </div>
    <div class="row justify-content-center round">
      <div class="col-lg-10 col-md-12">
        <div class="card shadow-lg card-1">
          <div class="card-body inner-card">
            <div class="row justify-content-center">
              <div class="col-md-12 col-lg-10 col-12">
                <div class="form-group files">
                  <label class="my-auto mb-2">Upload Your File </label>
                  <input id="fileinput" type="file" class="form-control" />
                </div>
              </div>
            </div>
            <div class="row justify-content-center">
              <div class="col-md-12 col-lg-10 col-12">
                <div class="mb-2 mt-4">
                  <div class="text-right">
                    <button
                      type="submit"
                      id="upload-btn"
                      class="btn btn-primary btn-block"
                    >
                      <small class="font-weight-bold">Upload</small>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <br />
            <hr />

            <div class="row justify-content-center">
              <div class="col-md-12 col-lg-10 col-12">
                <div class="mb-2 mt-4">
                  <div class="text-right">
                    <div class="progress" style="display: none">
                      <div
                        class="progress-bar"
                        role="progressbar"
                        style="width: 10%; display: none"
                        aria-valuenow="25"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      >
                        0%
                      </div>
                    </div>
                    <section class="uploaded-container">
                      <button
                        style="display: none"
                        id="loading"
                        class="btn btn-primary"
                        type="button"
                        disabled
                      >
                        <span
                          class="spinner-grow"
                          style="width: 1.5rem; height: 1.5rem"
                          role="status"
                          aria-hidden="true"
                        ></span>
                        Detecting faces...
                      </button>
                    </section>
                  </div>
                </div>
              </div>
            </div>
            <br />
            <hr />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %} {% block inline_javascript %}

<script src="{% static 'demo/js/demo.js' %}"></script>

<script>
  function showBar() {
    document
      .querySelector(".progress")
      .setAttribute("style", "display: block;");
  }
  function hideBar() {
    document.querySelector(".progress").setAttribute("style", "display: none;");
  }
  window.addEventListener("DOMContentLoaded", () => {
    const fileInput = document.getElementById("fileinput");
    const uploadBtn = document.getElementById("upload-btn");
    const progressBar = document.querySelector(".progress-bar");
    function showLoading() {
      document
        .querySelector("#loading")
        .setAttribute("style", "display: block");
    }

    function hideLoading() {
      document.querySelector("#loading").setAttribute("style", "display: none");
    }

    uploadBtn.addEventListener("click", (e) => {
      // show progress bar at 0%
      document
        .querySelector(".progress")
        .setAttribute("style", "display: block;");
      progressBar.setAttribute("style", `width: 0%`);
      progressBar.innerHTML = `0%`;

      e.preventDefault();

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/api/demo/", true);
      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) {
          const percentComplete = (e.loaded / e.total) * 100;
          progressBar.setAttribute(
            "style",
            `width: ${Math.round(percentComplete)}%`
          );
          progressBar.innerHTML = `${Math.round(percentComplete)}%`;
        }
      };

      xhr.onload = () => {
        if (xhr.readyState == 4) {
          setTimeout(hideBar(), 10000);
          showLoading()
          
        }
      };
      xhr.send(formData);
    });
  });
</script>
{% endblock inline_javascript %}
